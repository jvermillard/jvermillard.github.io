<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Notes: X.509 Certificates and the Internet-of-Things |
Julien Vermillard</title><meta charset=utf-8><meta name=generator content="Hugo 0.104.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Julien Vermillard"><meta name=description content="
      Julien Vermillard


    "><link rel=stylesheet href=/scss/main.min.5259d55db7b9c675f751f0865411bd84a410f3ffcb5105b8fc00b22fcb739309.css integrity="sha256-UlnVXbe5xnX3UfCGVBG9hKQQ8//LUQW4/ACyL8tzkwk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.69685904d5c2a0c6258d03c207b778c10466edf6cea928cc0164c376b0ad0930.css integrity="sha256-aWhZBNXCoMYljQPCB7d4wQRm7fbOqSjMAWTDdrCtCTA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.6d585e78d28cce1200d39fb133c92ed83df01738da721d0f48fb6eac62d24e04.css integrity="sha256-bVheeNKMzhIA05+xM8ku2D3wFzjach0PSPturGLSTgQ=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.6b00d96498d59caa0dbcf9b49d30d821915291f2ceb0e19248523c8607ff43fa.css integrity="sha256-awDZZJjVnKoNvPm0nTDYIZFSkfLOsOGSSFI8hgf/Q/o=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=http://vermillard.com/post/x509-iot/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.738c0e3a493854876aeab9e2316fd43f1936aeeac4cc6b3e60bb26456dba72ad.js integrity="sha256-c4wOOkk4VIdq6rniMW/UPxk2rurEzGs+YLsmRW26cq0=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://vermillard.com/images/site-feature-image.png"><meta name=twitter:title content="Notes: X.509 Certificates and the Internet-of-Things"><meta name=twitter:description content="Today most of IoT/M2M applications are using passwords, pre-shared keys or maybe no security for device communications."><meta property="og:title" content="Notes: X.509 Certificates and the Internet-of-Things"><meta property="og:description" content="Today most of IoT/M2M applications are using passwords, pre-shared keys or maybe no security for device communications."><meta property="og:type" content="article"><meta property="og:url" content="http://vermillard.com/post/x509-iot/"><meta property="og:image" content="http://vermillard.com/images/site-feature-image.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-04-13T00:00:00+00:00"><meta property="article:modified_time" content="2016-04-13T00:00:00+00:00"><meta property="og:site_name" content="My blog"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Notes: X.509 Certificates and the Internet-of-Things","headline":"Notes: X.509 Certificates and the Internet-of-Things","alternativeHeadline":"","description":"
      
        Today most of IoT\/M2M applications are using passwords, pre-shared keys or maybe no security for device communications.


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/vermillard.com\/post\/x509-iot\/"},"author":{"@type":"Person","name":"Julien Vermillard"},"creator":{"@type":"Person","name":"Julien Vermillard"},"accountablePerson":{"@type":"Person","name":"Julien Vermillard"},"copyrightHolder":{"@type":"Person","name":"Julien Vermillard"},"copyrightYear":"2016","dateCreated":"2016-04-13T00:00:00.00Z","datePublished":"2016-04-13T00:00:00.00Z","dateModified":"2016-04-13T00:00:00.00Z","publisher":{"@type":"Organization","name":"Julien Vermillard","url":"http://vermillard.com/","logo":{"@type":"ImageObject","url":"http:\/\/vermillard.com\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":["http://vermillard.com/images/site-feature-image.png"],"url":"http:\/\/vermillard.com\/post\/x509-iot\/","wordCount":"983","genre":[],"keywords":["Internet-of-Things","X509","PKI","security"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/profile.png alt="profile picture"><h1 class=sidebar__introduction-title><a href=/>My blog</a></h1><div class=sidebar__introduction-description><p>Julien Vermillard</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://linkedin.com/in/jvermillard/ rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/vrmvrm rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/jvermillard/ rel=me aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:julien@vermillard.com rel=me aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=/documents/cv.pdf rel=me aria-label=resume title=resume><i class="fas fa-file-pdf fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
2021 - 2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LTB2J9BZZP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LTB2J9BZZP")</script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/post/ title>Posts</a></li><li class=nav__list-item><a href=/portfolio/ title>Portfolio</a></li><li class=nav__list-item><a href=/publicspeaking/ title>Public Speaking</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Notes: X.509 Certificates and the Internet-of-Things</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>13/4/2016</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>5-minute read</span></li></ul><p>Today most of IoT/M2M applications are using passwords, pre-shared keys or maybe no security for device communications. Due to the expected massive deployment scale and the complex logistic behind it, more and more IoT shops want to deploy <a href=https://en.wikipedia.org/wiki/Public_key_infrastructure>Public Key Infrastructure</a> (PKI) based security. For example the new AWS IoT MQTT broker is enforcing using X.509 certificates for device authentication.</p><p><strong>The goal of this post is to share and write down the current state of my notes on the subject. Don’t expect something very well written :)</strong></p><p>In a nutshell PKI security is based on <a href=https://en.wikipedia.org/wiki/Certificate_authority>Certificate Authorities</a> (CA) delivering digital certificates to entities. For example an HTTPS based website will be certified by a CA for being the owner of a given Fully Qualified Domain Name (FQDN). If you click on the fancy lock icon in your browser you will see an example of a digital certificate issued by a CA :) For example the one of medium.com is issued by DigiCert and your browser trust DigiCert as a CA.</p><p>Now back to Internet-of-Thing: the idea is to put a certificate on all the devices you produce and want to connect. Also your server will get a certificate.</p><h3 id=the-first-challenge-is-computation-power>The first challenge is computation power</h3><p>Certificates authentication is based on <a href=https://en.wikipedia.org/wiki/Public-key_cryptography>public key cryptography</a>. Implementing the needed algorithms (RSA, DSA, ECDSA) can be a challenge on some targets. Hopefully more and more devices contains hardware accelerators or are not so constrained (32bit MCUs). This one is probably the most frightening at start but ECDSA is not so hard to fit inside embedded targets. Some interesting numbers on real hardware (Cortex-M): <a href=https://www.ietf.org/proceedings/92/slides/slides-92-lwig-3.pdf>https://www.ietf.org/proceedings/92/slides/slides-92-lwig-3.pdf</a></p><h3 id=increased-network-bandwidth-usage>Increased network bandwidth usage</h3><p>This can be critical for cellular connectivity where you pay per consumed kilobyte but also for or Low Power wireless technologies (like 6LowPAN, Thread or LTE-MTC) where the network packet size is constrained.</p><p>For example a DTLS handshake using PSK (pre-shared-key) security, will cost ~830 bytes. For a handshake based on X.509 certificates, it’ll cost at least 1500 bytes for a self signed ECDSA one, and more if you are using a complex certification chain. <a href=https://tools.ietf.org/html/rfc6066#page-9>The Client Certificate URLs extension</a> and <a href=https://datatracker.ietf.org/doc/draft-ietf-tls-cached-info/>TLS Cached Information Extension</a> can help in one way but not totally solve this problem.</p><h3 id=the-hardest-issue-verifying-certificate-validity>The hardest issue: Verifying certificate validity</h3><p>First step is to check the validity time range. A certificate have two dates: “not before” and “not after”. So your device needs to have a time source, and a secure one. Neither NTP, GPS , cellular network may be considered as secure time source. It letting you with little options, like relying on local network or hardware, or a PSK based authentication for a time service. Or simply combining all those strategy in a safe enough heuristic.</p><p>More details on this topic: <a href=https://www.ietf.org/mail-archive/web/dtls-iot/current/msg00657.html>https://www.ietf.org/mail-archive/web/dtls-iot/current/msg00657.html</a></p><p>The second step for validity check is too look for possible revocation of any element in the certification chain. Revocation is the idea of deprecating a certificate before it’s end-of-life date. Possible reasons are a security issue with one of the element of your PKI chain:</p><ul><li>server security issue compromising your private key: for example any bug like OpenSSL <a href=https://en.wikipedia.org/wiki/Heartbleed>“Heartbleed”</a></li><li>some cryptography issues, like you want to deprecate weak cryptographic algorithm, example: banning SHA-1 certificate for stronger hash algorithm</li><li>device security issue (tampering detection), so you want to revoke the device certificate</li><li>or simply you want to rotate a key, because it was used for too long or someone who had access to it left your company</li></ul><p>Anyway rotating your keys can be a good idea and you don’t want to have very short certificate validity period for devices because it can offline in a warehouse for quite some time.</p><p>How to check for certificate non-revocation?</p><h3 id=certificate-revocation-list-crl>Certificate Revocation List (CRL):</h3><p>In your certificates you have some URLs for downloading the CRL, for example, the medium ones are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>URI: http://crl3.digicert.com/sha2-ev-server-g1.crl
</span></span><span class=line><span class=cl>URI: http://crl4.digicert.com/sha2-ev-server-g1.crl
</span></span></code></pre></div><p>This is the compiled list of the certificate revoked by DigiCert. So for validating the certificate you receive from your peer wasn’t revoked, you need to download those lists and check if the received certificate is not here.</p><p>This method is now deprecated in favor of: <strong>The Online Certificate Status Protocol (OCSP)</strong>.</p><p>If you check the certificate you will find another URL, here for medium:</p><p><code>OCSP: URI: http://ocsp.digicert.com</code></p><p>This is a API URL, where you can ask for the revocation status of a given certificate. This is much more convenient than downloading and checking big CRL files. But OCSP is a little brittle, it can be easily took down with a DoS attack or simply not accessible in your private network.</p><p>Also it’s a another server to contact for your device. If your device is connected to your server using a VPN you need to provide a route for contacting all the possible OCSP API server to contact for validating all the possible certificate chains.</p><h3 id=ocsp-stapling>OCSP stapling</h3><p>An efficient way for the client to use OCSP is to ask the server to do the job and present the OCSP result directly via the (D)TLS protocol. In addition to his certificate, the server will present a non-revocation certificate using a TLS extension defined in <a href=https://tools.ietf.org/html/rfc6961>RFC6961</a>.</p><p>So the client don’t have to contact unreliable external OCSP servers. The TLS server will send a certificate status using a TLS extension. This status is a non-revocation certificate signed by the CA.</p><p>Stapling remove the main issues of OCSP: no more brittle API server to contact, no more external service to query and the server can cache his OCSP status for few minutes.</p><p>Another benefit: only one protocol on the client side, you don’t have to implement both (D)TLS and HTTP. You can do everything with your (D)TLS protocol, for example LWM2M. Can be useful for constrained devices and also for very constrained network were TCP is hardly working.</p><p>Keep in mind OCSP stapling is an optional extension and I’m pretty sure only few DTLS implementation support it.</p></div><div class=post__footer><span><a class=tag href=/tags/internet-of-things/>Internet-of-Things</a><a class=tag href=/tags/x509/>X509</a><a class=tag href=/tags/pki/>PKI</a><a class=tag href=/tags/security/>security</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
2021 - 2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LTB2J9BZZP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LTB2J9BZZP")</script></body></html>